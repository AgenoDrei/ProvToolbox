
<html>
<head> 
<title>PROV-TEMPLATE: A TEMPLATE SYSTEM FOR PROV DOCUMENTS</title> 
</head>
<body>

<section id="algorithm">

Basic algorithm:
<ol>
<li> create a mapping of 'group' to list of variables
<ul>
<li> for each variable, put it into a group:
      if specified use that group
      else create a new group (name used needs to be deterministic)
</ul>
</li>

<li> for each statement:
<ol>
<li> from the variables in that statement determine which groups it involves</li>
<li> use the list of involved groups and number of bindings in each to
    generate a multi-dimensional index</li>
<li> for each point in the index, write out the statement using the
   appropiate
    values in the variable bindings; app:order is the point index</li>
</ol>
</li>
</ol>

</section>

<section id="examples">

<pre>

Example A:

Template:
  entity(var:a)
  entity(var:b)
  wasAttributedTo(var:b, var:a)
Bindings:
  var:a = [uri1, uri2, uri3]
  var:b = [uriA, uriB]

groups = { 1: [var:a], 2: [var:b] }

statement 1:
  variables: var:a
  uses: group 1 (length 3)
  index: [(1),(2),(3)]
  write:
    entity(uri1, [app:order="1"])
    entity(uri2, [app:order="2"])
    entity(uri3, [app:order="3"])

statement 2:
  variables: var:b
  uses: group 2 (length 2)
  index: [(1),(2)]
  write:
    entity(uriA, [app:order="1"])
    entity(uriB, [app:order="2"])

statement 3:
  variables: var:b, var:a
  uses: group 2 (length 2), group 1 (length 3)
  index: [(1,1),(1,2)(1,3),(2,1),(2,2),(2,3)]
  write:
    wasAttributedTo(uriA, uri1, [app:order="1,1"])
    wasAttributedTo(uriA, uri2, [app:order="1,2"])
    wasAttributedTo(uriA, uri3, [app:order="1,3"])
    wasAttributedTo(uriB, uri1, [app:order="2,1"])
    wasAttributedTo(uriB, uri2, [app:order="2,2"])
    wasAttributedTo(uriB, uri3, [app:order="2,3"])

Example B:

Template:
  entity(var:a, [app:group='1'])
  entity(var:b, [app:group='1'])
  wasAttributedTo(var:b, var:a)
Bindings:
  var:a = [uri1, uri2]
  var:b = [uriA, uriB]
groups = { 1: [var:a, var:b] }
statement 1:
  variables: var:a
  uses: group 1 (length 2)
  index: [(1),(2)]
  write:
    entity(uri1, [app:order="1"])
    entity(uri2, [app:order="2"])

statement 2:
  variables: var:b
  uses: group 2 (length 2)
  index: [(1),(2)]
  write:
    entity(uriA, [app:order="1"])
    entity(uriB, [app:order="2"])

statement 3:
  variables: var:b, var:a
  uses: group 1 (length 2)
  index: [(1),(2)]
  write:
    wasAttributedTo(uriA, uri1, [app:order="1"])
    wasAttributedTo(uriB, uri2, [app:order="2"])
</pre>

<pre>
Template:
  entity(var:x)
  agent(var:ag)
  wasAttributedTo(var:x, var:ag, [ my:attr='var:a' ])
Bindings:
  var:x = [uri1, uri2, uri2]
  var:ag = [uriA, uriB]
  var:a = [[attr1], [attr2], [attr3], [attr4], [attr5], [attr6a, attr6b]]

Expands to:

  entity(uri1, [app:order="1"])
  entity(uri2, [app:order="2"])
  entity(uri3, [app:order="3"])

  entity(uriA, [app:order="1"])
  entity(uriB, [app:order="2"])

  wasAttributedTo(uri1, uriA, [my:attr='attr1', app:order="1,1"])
  wasAttributedTo(uri1, uriB, [my:attr='attr2', app:order="1,2"])
  wasAttributedTo(uri2, uriA, [my:attr='attr3', app:order="2,1"])
  wasAttributedTo(uri2, uriB, [my:attr='attr4', app:order="2,2"])
  wasAttributedTo(uri3, uriA, [my:attr='attr5', app:order="3,1"])
  wasAttributedTo(uri3, uriB, [my:attr='attr6a', my:attr='attr6b', app:order="3,2"])
</pre>
</section>

<section id="issues">

Issues:
<ul>
<li> when reloading back into a template/binding, we have no way of linking
  statements in the bundle back to statements in the template. I'm
  wondering if we need to name each statement in the template and refer to
  that in the generated.
<li> dealing with attributes. I dont think what we have in our current
  template examples is sufficient here. 
</ul>
</section>

<section id="environment">
<pre>
document
prefix app <http://a/>
prefix var <http://v/>
prefix ex <http://ex/>

entity(var:a,[app:value0='ex:foo',app:value1='ex:bar'])

entity(var:b,[prov:value='ex:foo', app:order=0])
entity(var:b,[prov:value='ex:bar', app:order=1])

endDocument
</pre>
</section>


</body>
</html>

